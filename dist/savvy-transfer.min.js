!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self)["savvy-transfer"]=e()}(this,function(){"use strict";function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e=t(function(_){!function(t){var c,e=Object.prototype,u=e.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",r=i.toStringTag||"@@toStringTag",a=t.regeneratorRuntime;if(a)_.exports=a;else{(a=t.regeneratorRuntime=_.exports).wrap=x;var f="suspendedStart",l="suspendedYield",d="executing",h="completed",m={},s={};s[o]=function(){return this};var p=Object.getPrototypeOf,v=p&&p(p(E([])));v&&v!==e&&u.call(v,o)&&(s=v);var g=k.prototype=w.prototype=Object.create(s);b.prototype=g.constructor=k,k.constructor=b,k[r]=b.displayName="GeneratorFunction",a.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,k):(t.__proto__=k,r in t||(t[r]="GeneratorFunction")),t.prototype=Object.create(g),t},a.awrap=function(t){return{__await:t}},S(L.prototype),L.prototype[n]=function(){return this},a.AsyncIterator=L,a.async=function(t,e,i,n){var o=new L(x(t,e,i,n));return a.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},S(g),g[r]="Generator",g[o]=function(){return this},g.toString=function(){return"[object Generator]"},a.keys=function(i){var n=[];for(var t in i)n.push(t);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in i)return t.value=e,t.done=!1,t}return t.done=!0,t}},a.values=E,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(I),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var n=this;function t(t,e){return r.type="throw",r.arg=i,n.next=t,e&&(n.method="next",n.arg=c),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],r=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var a=u.call(o,"catchLoc"),s=u.call(o,"finallyLoc");if(a&&s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;0<=i;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=e,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),I(i),m}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var o=n.arg;I(i)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:E(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=c),m}}}function x(t,e,i,n){var r,a,s,c,o=e&&e.prototype instanceof w?e:w,u=Object.create(o.prototype),p=new O(n||[]);return u._invoke=(r=t,a=i,s=p,c=f,function(t,e){if(c===d)throw new Error("Generator is already running");if(c===h){if("throw"===t)throw e;return D()}for(s.method=t,s.arg=e;;){var i=s.delegate;if(i){var n=z(i,s);if(n){if(n===m)continue;return n}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(c===f)throw c=h,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);c=d;var o=y(r,a,s);if("normal"===o.type){if(c=s.done?h:l,o.arg===m)continue;return{value:o.arg,done:s.done}}"throw"===o.type&&(c=h,s.method="throw",s.arg=o.arg)}}),u}function y(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}function w(){}function b(){}function k(){}function S(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function L(c){var e;this._invoke=function(i,n){function t(){return new Promise(function(t,e){!function e(t,i,n,o){var r=y(c[t],c,i);if("throw"!==r.type){var a=r.arg,s=a.value;return s&&"object"==typeof s&&u.call(s,"__await")?Promise.resolve(s.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):Promise.resolve(s).then(function(t){a.value=t,n(a)},function(t){return e("throw",t,n,o)})}o(r.arg)}(i,n,t,e)})}return e=e?e.then(t,t):t()}}function z(t,e){var i=t.iterator[e.method];if(i===c){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=c,z(t,e),"throw"===e.method))return m;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=y(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,m;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=c),e.delegate=null,m):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,m)}function j(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(j,this),this.reset(!0)}function E(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,n=function t(){for(;++i<e.length;)if(u.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=c,t.done=!0,t};return n.next=n}}return{next:D}}function D(){return{value:c,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())}),i=function(){return this||"object"==typeof self&&self}()||Function("return this")(),n=i.regeneratorRuntime&&0<=Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime"),o=n&&i.regeneratorRuntime;i.regeneratorRuntime=void 0;var r=e;if(n)i.regeneratorRuntime=o;else try{delete i.regeneratorRuntime}catch(t){i.regeneratorRuntime=void 0}var b=r;function c(t,e,i,n,o,r,a){try{var s=t[r](a),c=s.value}catch(t){return void i(t)}s.done?e(c):Promise.resolve(c).then(n,o)}var a=function(s){return function(){var t=this,a=arguments;return new Promise(function(e,i){var n=s.apply(t,a);function o(t){c(n,e,i,o,r,"next",t)}function r(t){c(n,e,i,o,r,"throw",t)}o(void 0)})}};var u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var p=function(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t},f=t(function(e){function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t){return"function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?e.exports=n=function(t){return i(t)}:e.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)},n(t)}e.exports=n});var l=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t};var d=function(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?l(t):e},h=t(function(e){function i(t){return e.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},i(t)}e.exports=i}),m=t(function(i){function n(t,e){return i.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}i.exports=n});var v=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)},g=function t(){u(this,t)},x={"3ds":"image/x-3ds","3g2":"video/3gpp2","3gp":"video/3gpp","7z":"application/x-7z-compressed",aac:"audio/x-aac",abw:"application/x-abiword",ace:"application/x-ace-compressed",adp:"audio/adpcm",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",apk:"application/vnd.android.package-archive",asf:"video/x-ms-asf",asx:"video/x-ms-asf",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bat:"application/x-msdownload",bmp:"image/bmp",btif:"image/prs.btif",bz:"application/x-bzip",bz2:"application/x-bzip2",caf:"audio/x-caf",cgm:"image/cgm",cmx:"image/x-cmx",com:"application/x-msdownload",conf:"text/plain",css:"text/css",csv:"text/csv",dbk:"application/docbook+xml",deb:"application/x-debian-package",def:"text/plain",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/x-msdownload",dmg:"application/x-apple-diskimage",doc:"application/msword",docm:"application/vnd.ms-word.document.macroenabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dra:"audio/vnd.dra",dtd:"application/xml-dtd",dts:"audio/vnd.dts",dtshd:"audio/vnd.dts.hd",dvb:"video/vnd.dvb.file",dwg:"image/vnd.dwg",dxf:"image/vnd.dxf",ecelp4800:"audio/vnd.nuera.ecelp4800",ecelp7470:"audio/vnd.nuera.ecelp7470",ecelp9600:"audio/vnd.nuera.ecelp9600",emf:"application/x-msmetafile",emz:"application/x-msmetafile",eol:"audio/vnd.digital-winds",epub:"application/epub+zip",exe:"application/x-msdownload",f4v:"video/x-f4v",fbs:"image/vnd.fastbidsheet",fh:"image/x-freehand",fh4:"image/x-freehand",fh5:"image/x-freehand",fh7:"image/x-freehand",fhc:"image/x-freehand",flac:"audio/x-flac",fli:"video/x-fli",flv:"video/x-flv",fpx:"image/vnd.fpx",fst:"image/vnd.fst",fvt:"video/vnd.fvt",g3:"image/g3fax",gif:"image/gif",h261:"video/h261",h263:"video/h263",h264:"video/h264",heif:"image/heif",heic:"image/heic",htm:"text/html",html:"text/html",ico:"image/x-icon",ief:"image/ief",iso:"application/x-iso9660-image",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",jpgm:"video/jpm",jpgv:"video/jpeg",jpm:"video/jpm",json:"application/json",jsonml:"application/jsonml+json",kar:"audio/midi",ktx:"image/ktx",list:"text/plain",log:"text/plain",lvp:"audio/vnd.lucent.voice",m13:"application/x-msmediaview",m14:"application/x-msmediaview",m1v:"video/mpeg",m21:"application/mp21",m2a:"audio/mpeg",m2v:"video/mpeg",m3a:"audio/mpeg",m3u:"audio/x-mpegurl",m3u8:"application/vnd.apple.mpegurl",m4a:"audio/mp4",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mdi:"image/vnd.ms-modi",mid:"audio/midi",midi:"audio/midi",mj2:"video/mj2",mjp2:"video/mj2",mk3d:"video/x-matroska",mka:"audio/x-matroska",mks:"video/x-matroska",mkv:"video/x-matroska",mmr:"image/vnd.fujixerox.edmics-mmr",mng:"video/x-mng",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp21:"application/mp21",mp2a:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mp4a:"audio/mp4",mp4s:"application/mp4",mp4v:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpg4:"video/mp4",mpga:"audio/mpeg",mpkg:"application/vnd.apple.installer+xml",msi:"application/x-msdownload",mvb:"application/x-msmediaview",mxf:"application/mxf",mxml:"application/xv+xml",mxu:"video/vnd.mpegurl",npx:"image/vnd.net-fpx",odb:"application/vnd.oasis.opendocument.database",odc:"application/vnd.oasis.opendocument.chart",odf:"application/vnd.oasis.opendocument.formula",odft:"application/vnd.oasis.opendocument.formula-template",odg:"application/vnd.oasis.opendocument.graphics",odi:"application/vnd.oasis.opendocument.image",odm:"application/vnd.oasis.opendocument.text-master",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogg:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otc:"application/vnd.oasis.opendocument.chart-template",otg:"application/vnd.oasis.opendocument.graphics-template",oth:"application/vnd.oasis.opendocument.text-web",oti:"application/vnd.oasis.opendocument.image-template",otp:"application/vnd.oasis.opendocument.presentation-template",ots:"application/vnd.oasis.opendocument.spreadsheet-template",ott:"application/vnd.oasis.opendocument.text-template",oxt:"application/vnd.openofficeorg.extension",pbm:"image/x-portable-bitmap",pct:"image/x-pict",pcx:"image/x-pcx",pdf:"application/pdf",pgm:"image/x-portable-graymap",pic:"image/x-pict",plb:"application/vnd.3gpp.pic-bw-large",png:"image/png",pnm:"image/x-portable-anymap",pot:"application/vnd.ms-powerpoint",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",psb:"application/vnd.3gpp.pic-bw-small",psd:"image/vnd.adobe.photoshop",pvb:"application/vnd.3gpp.pic-bw-var",pya:"audio/vnd.ms-playready.media.pya",pyv:"video/vnd.ms-playready.media.pyv",qt:"video/quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rgb:"image/x-rgb",rip:"audio/vnd.rip",rlc:"image/vnd.fujixerox.edmics-rlc",rmi:"audio/midi",rmp:"audio/x-pn-realaudio-plugin",s3m:"audio/s3m",sgi:"image/sgi",sgm:"text/sgml",sgml:"text/sgml",sid:"image/x-mrsid-image",sil:"audio/silk",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",smv:"video/x-smv",snd:"audio/basic",spx:"audio/ogg",srt:"application/x-subrip",sub:"text/vnd.dvb.subtitle",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",tcap:"application/vnd.3gpp2.tcap",text:"text/plain",tga:"image/x-tga",tif:"image/tiff",tiff:"image/tiff",torrent:"application/x-bittorrent",tsv:"text/tab-separated-values",ttl:"text/turtle",txt:"text/plain",udeb:"application/x-debian-package",uva:"audio/vnd.dece.audio",uvg:"image/vnd.dece.graphic",uvh:"video/vnd.dece.hd",uvi:"image/vnd.dece.graphic",uvm:"video/vnd.dece.mobile",uvp:"video/vnd.dece.pd",uvs:"video/vnd.dece.sd",uvu:"video/vnd.uvvu.mp4",uvv:"video/vnd.dece.video",uvva:"audio/vnd.dece.audio",uvvg:"image/vnd.dece.graphic",uvvh:"video/vnd.dece.hd",uvvi:"image/vnd.dece.graphic",uvvm:"video/vnd.dece.mobile",uvvp:"video/vnd.dece.pd",uvvs:"video/vnd.dece.sd",uvvu:"video/vnd.uvvu.mp4",uvvv:"video/vnd.dece.video",viv:"video/vnd.vivo",vob:"video/x-ms-vob",wav:"audio/x-wav",wax:"audio/x-ms-wax",wbmp:"image/vnd.wap.wbmp",wdp:"image/vnd.ms-photo",weba:"audio/webm",webm:"video/webm",webp:"image/webp",wm:"video/x-ms-wm",wma:"audio/x-ms-wma",wmf:"application/x-msmetafile",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wvx:"video/x-ms-wvx",xap:"application/x-silverlight-app",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xhvml:"application/xv+xml",xif:"image/vnd.xiff",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xm:"audio/xm",xml:"application/xml",xop:"application/xop+xml",xpl:"application/xproc+xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",xspf:"application/xspf+xml",xvm:"application/xv+xml",xvml:"application/xv+xml",xwd:"image/x-xwindowdump",zip:"application/zip"};function y(t){var e=function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];(t=String(t||""))||(t="unknown");var n=t.substr(t.lastIndexOf(".")+1);n===t?n="":i||9<(n=n.replace(/<[^>]*>/g,"").replace(/[^\w+]/g,"")).length&&(n=n.substr(0,9));return e?n.toUpperCase():n.toLowerCase()}(t);return x[e]||"application/octet-stream"}var w=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];function k(t,e,i){void 0===e&&(e=0),void 0===i&&(i=t.length);var n=0,o=t.length-i;e^=-1;for(var r=0;r<i;r++)n=255&(e^t[r+o]),e=e>>>8^w[n];return-1^e}for(var S=4294967296,L=[],z=0;z<256;z++)L[z]=(15<z?"":"0")+z.toString(16);var j="undefined"!=typeof Buffer,I=function(t,e){(j?t instanceof Buffer:t instanceof Uint8Array)?(this.buffer=t,this.offset=e||0):"[object Uint8Array]"==Object.prototype.toString.call(t)?(this.buffer=new Buffer(t),this.offset=e||0):(this.buffer=this.buffer||(j?new Buffer(8):new Uint8Array(8)),this.offset=0,this.setValue.apply(this,arguments))};I.MAX_INT=Math.pow(2,53),I.MIN_INT=-Math.pow(2,53);I.prototype={constructor:I,_2scomp:function(){for(var t=this.buffer,e=this.offset,i=1,n=e+7;e<=n;n--){var o=(255^t[n])+i;t[n]=255&o,i=o>>8}},setValue:function(t,e){var i=!1;if(1==arguments.length)if("number"==typeof t){if(i=t<0,e=(t=Math.abs(t))%S,S<(t/=S))throw new RangeError(t+" is outside Int64 range");t|=0}else{if("string"!=typeof t)throw new Error(t+" must be a Number or String");e=(t=(t+"").replace(/^0x/,"")).substr(-8),t=8<t.length?t.substr(0,t.length-8):"",t=parseInt(t,16),e=parseInt(e,16)}for(var n=this.buffer,o=this.offset,r=7;0<=r;r--)n[o+r]=255&e,e=4==r?t:e>>>8;i&&this._2scomp()},toNumber:function(t){for(var e=this.buffer,i=this.offset,n=128&e[i],o=0,r=1,a=7,s=1;0<=a;a--,s*=256){var c=e[i+a];n&&(r=(c=(255^c)+r)>>8,c&=255),o+=c*s}return!t&&o>=I.MAX_INT?n?-1/0:1/0:n?-o:o},valueOf:function(){return this.toNumber(!1)},toString:function(t){return this.valueOf().toString(t||10)},toOctetString:function(t){for(var e=new Array(8),i=this.buffer,n=this.offset,o=0;o<8;o++)e[o]=L[i[n+o]];return e.join(t||"")},toBuffer:function(t){if(t&&0===this.offset)return this.buffer;var e=new Buffer(8);return this.buffer.copy(e,0,this.offset,this.offset+8),e},copy:function(t,e){this.buffer.copy(t,e||0,this.offset,this.offset+8)},compare:function(t){if((128&this.buffer[this.offset])!=(128&t.buffer[t.offset]))return t.buffer[t.offset]-this.buffer[this.offset];for(var e=0;e<8;e++)if(this.buffer[this.offset+e]!==t.buffer[t.offset+e])return this.buffer[this.offset+e]-t.buffer[t.offset+e];return 0},equals:function(t){return 0===this.compare(t)},inspect:function(){return"[Int64 value:"+this+" octets:"+this.toOctetString(" ")+"]"}};try{0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(t){}var O=function(){function t(){u(this,t),this.writer=void 0,this.fileNames=[],this.files={},this.dataLength=0,this.offset=0,this.dirData=[]}var o;return p(t,[{key:"add",value:(o=a(b.mark(function t(e,n,i,o){var r,a,s,c,u,p,f,l,d,h,m,v,g,x,y,w;return b.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=new Uint8Array(i),a=k(r,e.crc||0,r.byteLength),s=new _(n.fileSize),c=unescape(encodeURIComponent(e.name)),e.bufferAcc+=r.byteLength,0===e.offset&&(e.headerPos=n.offset,(u=F(9+c.length)).i16(D),u.i16(5+c.length),u.i8(1),u.i32(k(c)),u.appendBytes(c),p=s.ZipHeader(c,e.fileSize,u.getArray()),(f=new Uint8Array(p.byteLength+r.byteLength)).set(p,0),f.set(r,p.byteLength),r=f),e.bufferAcc===e.fileSize?(l=s.ZipCentralDirectory(c,e.fileSize,e.fileSize,a,!1,e.headerPos),n.dirData.push(l.dirRecord),d=l.dataDescriptor,(h=new Uint8Array(r.byteLength+d.byteLength)).set(r,0),h.set(d,r.byteLength),r=h):e.offset+=r.byteLength,o){for(y in m=s.ZipSuffix(r.byteLength+n.offset,this.dirData),v=0,g=r.byteLength,n.dirData)v+=n.dirData[y].byteLength;for(w in(x=new Uint8Array(r.byteLength+v+m.byteLength)).set(r,0),n.dirData)x.set(n.dirData[w],g),g+=n.dirData[w].byteLength;x.set(m,g),r=x}return n.offset+=r.byteLength,t.abrupt("return",new Promise(function(e,t){var i=n.fileWriter;i.onwriteend=function(t){e()},i.onerror=function(){t()},i.write(new Blob([r]))}));case 11:case"end":return t.stop()}},t,this)})),function(t,e,i,n){return o.apply(this,arguments)})}]),t}();var E=4294967295,D=28789,_=function(){function e(t){u(this,e),this.maxZipSize=.9*Math.pow(2,31),this.isZip64=!1,this.zipVersion=20,this.isZip64=t>this.maxZipSize||1===localStorage.zip64,this.zipVersion=this.isZip64?45:20}return p(e,[{key:"ZipHeader",value:function(t,e,i){var n=this.zipVersion,o=F(30+t.length+i.length);return o.i32(67324752),o.i16(n),o.i16(2056),o.i16(0),A(0,o),o.i32(0),o.i32(e),o.i32(0),o.i16(t.length),o.i16(i.length),o.appendBytes(t),o.appendBytes(i),o.getBytes()}},{key:"ZipCentralDirectory",value:function(t,e,i,n,o,r){var a,s=this.zipVersion,c=this.zipVersion,u=o?1:0,p=[];this.isZip64&&((a=F(28)).i16(1),a.i16(24),a.i64(e),a.i64(i),a.i64(r),p=p.concat(a.getArray()));var f=F(46+t.length+p.length);f.i32(33639248),f.i16(s),f.i16(c),f.i16(2056),f.i16(0),A(0,f),f.i32(n),f.i32(this.isZip64?E:e),f.i32(this.isZip64?E:i),f.i16(t.length),f.i16(p.length),f.i16(0),f.i32(0),f.i32(u),f.i32(this.isZip64?E:r),f.appendBytes(t),f.appendBytes(p);var l=F(this.isZip64?24:16);return l.i32(134695760),l.i32(n),this.isZip64?(l.i64(e),l.i64(i)):(l.i32(e),l.i32(i)),{dirRecord:f.getBytes(),dataDescriptor:l.getBytes()}}},{key:"ZipSuffix",value:function(t,e){var i=0;for(var n in e)i+=e[n].length;var o=F(22);if(this.isZip64){var r=F(76);r.i32(101075792),r.i64(44),r.i16(this.zipVersion),r.i16(this.zipVersion),r.i32(0),r.i32(0),r.i64(e.length),r.i64(e.length),r.i64(i),r.i64(t),r.i32(117853008),r.i32(0),r.i64(t+i),r.i32(1),o.resize(22+r.getBytes().length),o.appendBytes(r.getBytes())}return o.i32(101010256),o.i32(0),o.i16(this.isZip64?65535:e.length),o.i16(this.isZip64?65535:e.length),o.i32(this.isZip64?E:i),o.i32(this.isZip64?E:t),o.i16(0),o.getBytes()}}]),e}();function F(t){var o=new Uint8Array(t),i=new DataView(o.buffer),n=0;return{debug:function(){},getArray:function(){var n=[];return o.map(function(t,e,i){return n.push(t),t}),n},getBytes:function(){return o},appendBytes:function(t){for(var e="string"!=typeof t,i=t.length;i--;)o[n+i]=e?t[i]:t.charCodeAt(i);n+=t.length},i64:function(t,e){var i=new I(t).buffer;if(!e){for(var n=new Uint8Array(i.length),o=i.length-1,r=o;0<=r;r--)n[r]=i[o-r];i=n}this.appendBytes(i)},i32:function(t,e){i.setInt32(n,t,!e),n+=4},i16:function(t,e){i.setInt16(n,t,!e),n+=2},i8:function(t,e){i.setInt8(n,t),n+=1},resize:function(t){var e=new Uint8Array(t);return e.set(o,0),o=e,i=new DataView(o.buffer),o},resizeIfNeeded:function(t){return o.length<t+n?this.resize(t+n):o}}}function A(t,e){var i,n,o=new Date;t&&(o=new Date(1e3*t)),i=o.getHours(),i<<=6,i|=o.getMinutes(),i<<=5,i|=o.getSeconds()/2,n=o.getFullYear()-1980,n<<=4,n|=o.getMonth()+1,n<<=5,n|=o.getDate(),e.i16(i),e.i16(n)}var Z=window,P=function(t){function e(){var n;return u(this,e),(n=d(this,h(e).call(this))).saveLink=function(t,e){var i="string"==typeof e&&e,n=document.createElement("a");n.download=t.name,n.href=i||t.fileEntry.toURL(),n.click()},n.saveFile=function(e,t){try{var i=new File([t],e.name,{type:y(e.name)});n.saveLink(e,window.URL.createObjectURL(i))}catch(t){n.saveLink(e)}},Z.requestFileSystem=Z.requestFileSystem||Z.webkitRequestFileSystem,Z.requestFileSystem(0,65536,function(t){t.root.getDirectory("savvy",{create:!0},function(t){t.createReader().readEntries(function(t){t.map(function(t){t.remove(function(){})})})})}),n}return v(e,g),p(e,[{key:"getFileWriter",value:function(i,n,t){Z.requestFileSystem(0,i.fileSize,function(e){e.root.getDirectory("savvy",{create:!0},function(t){e.root.getFile("savvy/"+i.name,{create:!0},function(e){e.createWriter(function(t){n({fileEntry:e,fileWriter:t})})})})})}},{key:"free_space",value:function(t,e,i){}},{key:"createTmpFile",value:function(){var o=this,r="tmp.zip";return new Promise(function(i,n){Z.requestFileSystem(0,4294967296,function(e){e.root.getFile(r,void 0,function(t){t.remove(function(){o.create(e,r,i,n)},function(){o.create(e,r,i,n)})},function(){o.create(e,r,i,n)})})})}},{key:"create",value:function(t,e,i,n){t.root.getFile(e,{create:!0},function(t){i(t)},function(){n()})}},{key:"write",value:function(a,s){return new Promise(function(e,i){if(a.fileWriter){var t=a.fileWriter;if(a.isZip){var n=a,o=new O,r=n.currentFile;o.add(r,n,s,n.nowChunkIndex===n.chunklist.length).then(function(){e()})}else try{t.onwriteend=function(t){e()},t.write(new Blob([s]))}catch(t){i()}}else i()})}},{key:"download",value:function(n){for(var o=this,t=function(e,t){var i=n[e].fileEntry;if("function"==typeof n[e].fileEntry.file)try{i.file(function(t){o.saveFile(n[e],t)},function(){o.saveLink(n[e])})}catch(t){}else o.saveLink(n[e])},e=0,i=n.length;e<i;e++)t(e)}}]),e}(),R=function(){function c(t,e,i,n,o){var r=this;u(this,c),this.isZip=!1,this.chunklist=[],this.status=void 0,this.filePath=void 0,this.name=void 0,this.fileSize=void 0,this.chunkSize=void 0,this.fileWriter=void 0,this.fileEntry=void 0,this.nowChunkIndex=0,this.IO=void 0,this.offset=0,this.crc=0,this.headerPos=0,this.bufferAcc=0,this.init=function(){return new Promise(function(e,t){r.IO.getFileWriter(r,function(t){r.fileWriter=t.fileWriter,r.fileEntry=t.fileEntry,r.status="inited",e()},t)})},this.status="initializing",this.filePath=t,this.name=e,this.fileSize=i,this.chunkSize=n,this.IO=o;for(var a=0,s=0;s<this.fileSize;)s=(s=a+this.chunkSize)>this.fileSize?this.fileSize:s,this.chunklist.push({filePath:this.filePath,start:a,end:s}),a=s+1}return p(c,[{key:"nextChunk",value:function(){return this.chunklist[this.nowChunkIndex+1]||(this.status="chunk_empty"),this.chunklist[this.nowChunkIndex++]}}]),c}(),B=function(){function a(t,e,i){var n=this;u(this,a),this.chunklist=[],this.status=void 0,this.isZip=!0,this.fileWriter=void 0,this.fileEntry=void 0,this.name=void 0,this.fileSize=0,this.totalSize=void 0,this.files=void 0,this.nowChunkIndex=0,this.IO=void 0,this.offset=0,this.dirData=[],this.init=function(){return new Promise(function(e,t){n.IO.getFileWriter(n,function(t){n.fileWriter=t.fileWriter,n.fileEntry=t.fileEntry,n.status="inited",e()},t)})},this.status="initializing",this.IO=i,this.name=e,this.files=t,this.totalSize=t.reduce(function(t,e){return t+e.fileSize},0);for(var o=0,r=t.length;o<r;o++)this.fileSize+=t[o].fileSize+30+9+2*t[o].name.length+46+t[o].name.length;this.fileSize+=28*t.length,this.fileSize+=24*t.length,this.fileSize+=98,this.chunklist=t.reduce(function(t,e){return t.concat(e.chunklist)},[])}return p(a,[{key:"nextChunk",value:function(){return this.chunklist[this.nowChunkIndex+1]||(this.status="chunk_empty"),this.chunklist[this.nowChunkIndex++]}},{key:"currentFile",get:function(){for(var t=this.nowChunkIndex-1,e=0,i=this.files[0],n=0,o=this.files.length;n<o;n++)if(t<(e+=this.files[n].chunklist.length)){i=this.files[n];break}return i}}]),a}(),C=/\b(WOW64|x86_64|Win64|intel mac os x 10.(9|\d{2,}))/i.test(navigator.userAgent),N=function(){function c(){var r=this;u(this,c),this.IO=void 0,this.size=0,this.fileInited=0,this.fileAllAdded=!1,this.readyForDownload=!1,this.waitReadyAndDownload=!1,this.files=[],this.scheduleDownload=function(t){if(r.readyForDownload){if(t)"inited"===t.status?r.fetchData(t):r.IO.download([t]);else if(0<r.files.length){var e=r.files.find(function(t){return"inited"===t.status});e?r.fetchData(e):r.IO.download(r.files.filter(function(t){return"chunk_empty"===t.status}))}}else r.waitReadyAndDownload=!0},this.fetchData=function(){var e=a(b.mark(function t(e){var i,n,o;return b.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.nextChunk(),t.next=3,fetch(i.filePath,{method:"GET",headers:{Range:"bytes=".concat(i.start,"-").concat(i.end)}});case 3:return n=t.sent,t.next=6,n.arrayBuffer();case 6:return o=t.sent,t.next=9,r.IO.write(e,o);case 9:return e.isZip?r.scheduleDownload(e):r.scheduleDownload(),t.abrupt("return");case 11:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),this.IO=new P}var i,n,e;return p(c,[{key:"setIOMethod",value:function(){}},{key:"addFiles",value:(e=a(b.mark(function t(e){var i,n,o,r,a,s,c=arguments;return b.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=1<c.length&&void 0!==c[1]&&c[1],n=[],o=0,r=e.length;case 3:if(o<r)return t.next=6,this._addFile(e[o].path,e[o].name,i);t.next=11;break;case 6:(a=t.sent)&&n.push(a);case 8:o++,t.next=3;break;case 11:if(s=null,i)return s=new B(n,"test.zip",this.IO),t.next=16,s.init();t.next=16;break;case 16:if(this.readyForDownload=!0,this.waitReadyAndDownload&&(this.waitReadyAndDownload=!1,this.scheduleDownload()),i)return t.abrupt("return",s);t.next=22;break;case 22:return t.abrupt("return",n);case 23:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"addFile",value:(n=a(b.mark(function t(e,i){var n;return b.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._addFile(e,i);case 2:return n=t.sent,this.readyForDownload=!0,this.waitReadyAndDownload&&(this.waitReadyAndDownload=!1,this.scheduleDownload()),t.abrupt("return",n);case 6:case"end":return t.stop()}},t,this)})),function(t,e){return n.apply(this,arguments)})},{key:"showFiles",value:function(){}},{key:"_addFile",value:(i=a(b.mark(function t(e,i){var n,o,r,a,s=arguments;return b.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=2<s.length&&void 0!==s[2]&&s[2],e){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,fetch(e,{method:"GET",headers:{Range:"bytes=0-1"}});case 6:if((o=t.sent).headers.get("content-range")){t.next=10;break}return t.abrupt("return");case 10:if(r=parseInt(o.headers.get("content-range").split("/")[1]),a=new R(e,i,r,c.CHUNK_SIZE,this.IO),n){t.next=15;break}return t.next=15,a.init();case 15:return this.files.push(a),t.abrupt("return",a);case 17:case"end":return t.stop()}},t,this)})),function(t,e){return i.apply(this,arguments)})},{key:"upload",value:function(t){}}]),c}();return N.SIZE_LIMIT=1073741824*(1+(C?1:0)),N.CHUNK_SIZE=16777216,N});
