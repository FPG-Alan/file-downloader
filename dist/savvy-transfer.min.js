!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self)["savvy-transfer"]=t()}(this,function(){"use strict";function e(e,t){return e(t={exports:{}},t.exports),t.exports}var t=e(function(I){!function(e){var c,t=Object.prototype,s=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",n=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag",r=e.regeneratorRuntime;if(r)I.exports=r;else{(r=e.regeneratorRuntime=I.exports).wrap=x;var l="suspendedStart",u="suspendedYield",m="executing",f="completed",v={},p={};p[o]=function(){return this};var d=Object.getPrototypeOf,h=d&&d(d(R([])));h&&h!==t&&s.call(h,o)&&(p=h);var g=k.prototype=y.prototype=Object.create(p);b.prototype=g.constructor=k,k.constructor=b,k[a]=b.displayName="GeneratorFunction",r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,a in e||(e[a]="GeneratorFunction")),e.prototype=Object.create(g),e},r.awrap=function(e){return{__await:e}},j(E.prototype),E.prototype[n]=function(){return this},r.AsyncIterator=E,r.async=function(e,t,i,n){var o=new E(x(e,t,i,n));return r.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},j(g),g[a]="Generator",g[o]=function(){return this},g.toString=function(){return"[object Generator]"},r.keys=function(i){var n=[];for(var e in i)n.push(e);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in i)return e.value=t,e.done=!1,e}return e.done=!0,e}},r.values=R,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=c)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var n=this;function e(e,t){return a.type="throw",a.arg=i,n.next=e,t&&(n.method="next",n.arg=c),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],a=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var r=s.call(o,"catchLoc"),p=s.call(o,"finallyLoc");if(r&&p){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(r){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!p)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;0<=i;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),O(i),v}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var o=n.arg;O(i)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:R(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=c),v}}}function x(e,t,i,n){var a,r,p,c,o=t&&t.prototype instanceof y?t:y,s=Object.create(o.prototype),d=new _(n||[]);return s._invoke=(a=e,r=i,p=d,c=l,function(e,t){if(c===m)throw new Error("Generator is already running");if(c===f){if("throw"===e)throw t;return S()}for(p.method=e,p.arg=t;;){var i=p.delegate;if(i){var n=L(i,p);if(n){if(n===v)continue;return n}}if("next"===p.method)p.sent=p._sent=p.arg;else if("throw"===p.method){if(c===l)throw c=f,p.arg;p.dispatchException(p.arg)}else"return"===p.method&&p.abrupt("return",p.arg);c=m;var o=w(a,r,p);if("normal"===o.type){if(c=p.done?f:u,o.arg===v)continue;return{value:o.arg,done:p.done}}"throw"===o.type&&(c=f,p.method="throw",p.arg=o.arg)}}),s}function w(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}function y(){}function b(){}function k(){}function j(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function E(c){var t;this._invoke=function(i,n){function e(){return new Promise(function(e,t){!function t(e,i,n,o){var a=w(c[e],c,i);if("throw"!==a.type){var r=a.arg,p=r.value;return p&&"object"==typeof p&&s.call(p,"__await")?Promise.resolve(p.__await).then(function(e){t("next",e,n,o)},function(e){t("throw",e,n,o)}):Promise.resolve(p).then(function(e){r.value=e,n(r)},function(e){return t("throw",e,n,o)})}o(a.arg)}(i,n,e,t)})}return t=t?t.then(e,e):e()}}function L(e,t){var i=e.iterator[t.method];if(i===c){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=c,L(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var n=w(i,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,v;var o=n.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=c),t.delegate=null,v):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function F(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(F,this),this.reset(!0)}function R(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(s.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=c,e.done=!0,e};return n.next=n}}return{next:S}}function S(){return{value:c,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())}),i=function(){return this||"object"==typeof self&&self}()||Function("return this")(),n=i.regeneratorRuntime&&0<=Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime"),o=n&&i.regeneratorRuntime;i.regeneratorRuntime=void 0;var a=t;if(n)i.regeneratorRuntime=o;else try{delete i.regeneratorRuntime}catch(e){i.regeneratorRuntime=void 0}var p=a;function c(e,t,i,n,o,a,r){try{var p=e[a](r),c=p.value}catch(e){return void i(e)}p.done?t(c):Promise.resolve(c).then(n,o)}var s=function(p){return function(){var e=this,r=arguments;return new Promise(function(t,i){var n=p.apply(e,r);function o(e){c(n,t,i,o,a,"next",e)}function a(e){c(n,t,i,o,a,"throw",e)}o(void 0)})}};var d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e},u=e(function(t){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e){return"function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?t.exports=n=function(e){return i(e)}:t.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":i(e)},n(e)}t.exports=n});var m=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e};var f=function(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?m(e):t},v=e(function(t){function i(e){return t.exports=i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}t.exports=i}),h=e(function(i){function n(e,t){return i.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}i.exports=n});var g=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)},x=function e(){d(this,e)},w={"3ds":"image/x-3ds","3g2":"video/3gpp2","3gp":"video/3gpp","7z":"application/x-7z-compressed",aac:"audio/x-aac",abw:"application/x-abiword",ace:"application/x-ace-compressed",adp:"audio/adpcm",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",apk:"application/vnd.android.package-archive",asf:"video/x-ms-asf",asx:"video/x-ms-asf",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bat:"application/x-msdownload",bmp:"image/bmp",btif:"image/prs.btif",bz:"application/x-bzip",bz2:"application/x-bzip2",caf:"audio/x-caf",cgm:"image/cgm",cmx:"image/x-cmx",com:"application/x-msdownload",conf:"text/plain",css:"text/css",csv:"text/csv",dbk:"application/docbook+xml",deb:"application/x-debian-package",def:"text/plain",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/x-msdownload",dmg:"application/x-apple-diskimage",doc:"application/msword",docm:"application/vnd.ms-word.document.macroenabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",dra:"audio/vnd.dra",dtd:"application/xml-dtd",dts:"audio/vnd.dts",dtshd:"audio/vnd.dts.hd",dvb:"video/vnd.dvb.file",dwg:"image/vnd.dwg",dxf:"image/vnd.dxf",ecelp4800:"audio/vnd.nuera.ecelp4800",ecelp7470:"audio/vnd.nuera.ecelp7470",ecelp9600:"audio/vnd.nuera.ecelp9600",emf:"application/x-msmetafile",emz:"application/x-msmetafile",eol:"audio/vnd.digital-winds",epub:"application/epub+zip",exe:"application/x-msdownload",f4v:"video/x-f4v",fbs:"image/vnd.fastbidsheet",fh:"image/x-freehand",fh4:"image/x-freehand",fh5:"image/x-freehand",fh7:"image/x-freehand",fhc:"image/x-freehand",flac:"audio/x-flac",fli:"video/x-fli",flv:"video/x-flv",fpx:"image/vnd.fpx",fst:"image/vnd.fst",fvt:"video/vnd.fvt",g3:"image/g3fax",gif:"image/gif",h261:"video/h261",h263:"video/h263",h264:"video/h264",heif:"image/heif",heic:"image/heic",htm:"text/html",html:"text/html",ico:"image/x-icon",ief:"image/ief",iso:"application/x-iso9660-image",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",jpgm:"video/jpm",jpgv:"video/jpeg",jpm:"video/jpm",json:"application/json",jsonml:"application/jsonml+json",kar:"audio/midi",ktx:"image/ktx",list:"text/plain",log:"text/plain",lvp:"audio/vnd.lucent.voice",m13:"application/x-msmediaview",m14:"application/x-msmediaview",m1v:"video/mpeg",m21:"application/mp21",m2a:"audio/mpeg",m2v:"video/mpeg",m3a:"audio/mpeg",m3u:"audio/x-mpegurl",m3u8:"application/vnd.apple.mpegurl",m4a:"audio/mp4",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mdi:"image/vnd.ms-modi",mid:"audio/midi",midi:"audio/midi",mj2:"video/mj2",mjp2:"video/mj2",mk3d:"video/x-matroska",mka:"audio/x-matroska",mks:"video/x-matroska",mkv:"video/x-matroska",mmr:"image/vnd.fujixerox.edmics-mmr",mng:"video/x-mng",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp21:"application/mp21",mp2a:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mp4a:"audio/mp4",mp4s:"application/mp4",mp4v:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpg4:"video/mp4",mpga:"audio/mpeg",mpkg:"application/vnd.apple.installer+xml",msi:"application/x-msdownload",mvb:"application/x-msmediaview",mxf:"application/mxf",mxml:"application/xv+xml",mxu:"video/vnd.mpegurl",npx:"image/vnd.net-fpx",odb:"application/vnd.oasis.opendocument.database",odc:"application/vnd.oasis.opendocument.chart",odf:"application/vnd.oasis.opendocument.formula",odft:"application/vnd.oasis.opendocument.formula-template",odg:"application/vnd.oasis.opendocument.graphics",odi:"application/vnd.oasis.opendocument.image",odm:"application/vnd.oasis.opendocument.text-master",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogg:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otc:"application/vnd.oasis.opendocument.chart-template",otg:"application/vnd.oasis.opendocument.graphics-template",oth:"application/vnd.oasis.opendocument.text-web",oti:"application/vnd.oasis.opendocument.image-template",otp:"application/vnd.oasis.opendocument.presentation-template",ots:"application/vnd.oasis.opendocument.spreadsheet-template",ott:"application/vnd.oasis.opendocument.text-template",oxt:"application/vnd.openofficeorg.extension",pbm:"image/x-portable-bitmap",pct:"image/x-pict",pcx:"image/x-pcx",pdf:"application/pdf",pgm:"image/x-portable-graymap",pic:"image/x-pict",plb:"application/vnd.3gpp.pic-bw-large",png:"image/png",pnm:"image/x-portable-anymap",pot:"application/vnd.ms-powerpoint",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppm:"image/x-portable-pixmap",pps:"application/vnd.ms-powerpoint",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",psb:"application/vnd.3gpp.pic-bw-small",psd:"image/vnd.adobe.photoshop",pvb:"application/vnd.3gpp.pic-bw-var",pya:"audio/vnd.ms-playready.media.pya",pyv:"video/vnd.ms-playready.media.pyv",qt:"video/quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rgb:"image/x-rgb",rip:"audio/vnd.rip",rlc:"image/vnd.fujixerox.edmics-rlc",rmi:"audio/midi",rmp:"audio/x-pn-realaudio-plugin",s3m:"audio/s3m",sgi:"image/sgi",sgm:"text/sgml",sgml:"text/sgml",sid:"image/x-mrsid-image",sil:"audio/silk",sldx:"application/vnd.openxmlformats-officedocument.presentationml.slide",smv:"video/x-smv",snd:"audio/basic",spx:"audio/ogg",srt:"application/x-subrip",sub:"text/vnd.dvb.subtitle",svg:"image/svg+xml",svgz:"image/svg+xml",swf:"application/x-shockwave-flash",tcap:"application/vnd.3gpp2.tcap",text:"text/plain",tga:"image/x-tga",tif:"image/tiff",tiff:"image/tiff",torrent:"application/x-bittorrent",tsv:"text/tab-separated-values",ttl:"text/turtle",txt:"text/plain",udeb:"application/x-debian-package",uva:"audio/vnd.dece.audio",uvg:"image/vnd.dece.graphic",uvh:"video/vnd.dece.hd",uvi:"image/vnd.dece.graphic",uvm:"video/vnd.dece.mobile",uvp:"video/vnd.dece.pd",uvs:"video/vnd.dece.sd",uvu:"video/vnd.uvvu.mp4",uvv:"video/vnd.dece.video",uvva:"audio/vnd.dece.audio",uvvg:"image/vnd.dece.graphic",uvvh:"video/vnd.dece.hd",uvvi:"image/vnd.dece.graphic",uvvm:"video/vnd.dece.mobile",uvvp:"video/vnd.dece.pd",uvvs:"video/vnd.dece.sd",uvvu:"video/vnd.uvvu.mp4",uvvv:"video/vnd.dece.video",viv:"video/vnd.vivo",vob:"video/x-ms-vob",wav:"audio/x-wav",wax:"audio/x-ms-wax",wbmp:"image/vnd.wap.wbmp",wdp:"image/vnd.ms-photo",weba:"audio/webm",webm:"video/webm",webp:"image/webp",wm:"video/x-ms-wm",wma:"audio/x-ms-wma",wmf:"application/x-msmetafile",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wvx:"video/x-ms-wvx",xap:"application/x-silverlight-app",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xhvml:"application/xv+xml",xif:"image/vnd.xiff",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xm:"audio/xm",xml:"application/xml",xop:"application/xop+xml",xpl:"application/xproc+xml",xpm:"image/x-xpixmap",xsl:"application/xml",xslt:"application/xslt+xml",xspf:"application/xspf+xml",xvm:"application/xv+xml",xvml:"application/xv+xml",xwd:"image/x-xwindowdump",zip:"application/zip"};function y(e){var t=function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];(e=String(e||""))||(e="unknown");var n=e.substr(e.lastIndexOf(".")+1);n===e?n="":i||9<(n=n.replace(/<[^>]*>/g,"").replace(/[^\w+]/g,"")).length&&(n=n.substr(0,9));return t?n.toUpperCase():n.toLowerCase()}(e);return w[t]||"application/octet-stream"}var b=window,k=function(e){function n(e,t,i){var o;return d(this,n),(o=f(this,v(n).call(this))).size=void 0,o.downloadSize=0,o.fileName=void 0,o.fileWriter=null,o.fileEntry=null,o.writing=!1,o.writeEndResolve=null,o.writeEndReject=null,o.handleFileWriteStart=function(e){o.writing=!0},o.handleFileWriteProgress=function(e){},o.handleFileWriteError=function(e){o.writing=!1},o.handleFileWriteEnd=function(e){o.writing=!1,o.writeEndResolve&&(o.writeEndResolve(),o.writeEndReject=null,o.writeEndResolve=null)},o.saveLink=function(e,t){var i="string"==typeof t&&t,n=document.createElement("a");n.download=o.fileName,n.href=i||o.fileEntry.toURL(),n.click()},o.saveFile=function(e){try{var t=new File([e],o.fileName,{type:y(o.fileName)});o.saveLink(void 0,window.URL.createObjectURL(t))}catch(e){o.saveLink()}},o.size=e,o.fileName=t,b.requestFileSystem=b.requestFileSystem||b.webkitRequestFileSystem,b.requestFileSystem(0,e,function(t){t.root.getDirectory("savvy",{create:!0},function(e){e.createReader().readEntries(function(e){}),t.root.getFile("savvy/"+o.fileName,{create:!0},function(e){(o.fileEntry=e).createWriter(function(e){o.fileWriter=e,o.fileWriter.onwritestart=o.handleFileWriteStart,o.fileWriter.onprogress=o.handleFileWriteProgress,o.fileWriter.onerror=o.handleFileWriteError,o.fileWriter.onwriteend=o.handleFileWriteEnd,i&&i()})})})}),o}return g(n,x),l(n,[{key:"free_space",value:function(e,t,i){}},{key:"write",value:function(e){var i=this;if(!this.fileWriter)return new Promise(function(e,t){t("no file writer.")});try{return this.fileWriter.write(new Blob([e])),new Promise(function(e,t){i.writeEndResolve=e,i.writeEndReject=t})}catch(i){return new Promise(function(e,t){t(i)})}}},{key:"download",value:function(e){if("function"==typeof this.fileEntry.file)try{this.fileEntry.file(this.saveFile,this.saveLink)}catch(e){}else this.saveLink()}}]),n}(),j=function(){function c(e,t,i,n,o,a){d(this,c),this.chunklist=[],this.status=void 0,this.filePath=void 0,this.name=void 0,this.nowChunkIndex=0,this.IO=void 0,this.status="initializing",this.filePath=e,this.name=t;for(var r=0,p=0;p<i;)p=i<(p=r+n)?i:p,this.chunklist.push({start:r,end:p}),r=p+1;this.status="inited",this.IO=new o(i,t,a)}var t;return l(c,[{key:"nextChunk",value:function(){return this.chunklist[this.nowChunkIndex+1]||(this.status="chunk_empty"),this.chunklist[this.nowChunkIndex++]}},{key:"write",value:(t=s(p.mark(function e(t){var i;return p.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.arrayBuffer();case 2:return i=e.sent,e.next=5,this.IO.write(i);case 5:return e.abrupt("return");case 7:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"download",value:function(){this.status="downloading",this.IO.download(this.name),this.status="complete"}}]),c}(),E=/\b(WOW64|x86_64|Win64|intel mac os x 10.(9|\d{2,}))/i.test(navigator.userAgent),L=function(){function r(){var o=this;d(this,r),this.IOMethod=void 0,this.size=0,this.fileInited=0,this.fileAllAdded=!1,this.readyForDownload=!1,this.waitReadyAndDownload=!1,this.files=[],this.handleFileInit=function(){o.fileInited+=1,o.fileAllAdded&&o.fileInited===o.files.length&&(o.readyForDownload=!0,o.waitReadyAndDownload&&(o.waitReadyAndDownload=!1,o.scheduleDownload()))},this.scheduleDownload=function(){if(o.readyForDownload){if(0<o.files.length){var e=o.files.find(function(e){return"inited"===e.status});e?o.fetchData(e):o.downloadFile(o.files.filter(function(e){return"chunk_empty"===e.status}))}}else o.waitReadyAndDownload=!0},this.fetchData=function(){var t=s(p.mark(function e(t){var i,n;return p.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.nextChunk(),e.next=4,fetch(t.filePath,{method:"GET",headers:{Range:"bytes=".concat(i.start,"-").concat(i.end)}});case 4:return n=e.sent,e.next=7,t.write(n);case 7:return o.scheduleDownload(),e.abrupt("return");case 9:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),this.IOMethod=k}var i,t,n,o;return l(r,[{key:"setIOMethod",value:function(){}},{key:"addFiles",value:(o=s(p.mark(function e(t){var i,n,o,a;return p.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=[],n=0,o=t.length;case 2:if(n<o)return e.next=5,this._addFile(t[n].path,t[n].name);e.next=10;break;case 5:(a=e.sent)&&i.push(a);case 7:n++,e.next=2;break;case 10:return this.fileAllAdded=!0,e.abrupt("return",i);case 12:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"addFile",value:(n=s(p.mark(function e(t,i){var n;return p.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._addFile(t,i);case 2:return n=e.sent,this.fileAllAdded=!0,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"addZipFiles",value:(t=s(p.mark(function e(t){return p.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 2:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"showFiles",value:function(){}},{key:"_addFile",value:(i=s(p.mark(function e(t,i){var n,o,a;return p.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,fetch(t,{method:"GET",headers:{Range:"bytes=0-1"}});case 6:if((n=e.sent).headers.get("content-range")){e.next=10;break}return e.abrupt("return");case 10:return o=parseInt(n.headers.get("content-range").split("/")[1]),a=new j(t,i,o,r.CHUNK_SIZE,this.IOMethod,this.handleFileInit),this.files.push(a),e.abrupt("return",a);case 14:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"downloadFile",value:function(e){for(var t=0,i=e.length;t<i;t++)e[t].download()}},{key:"upload",value:function(e){}}]),r}();return L.SIZE_LIMIT=1073741824*(1+(E?1:0)),L.CHUNK_SIZE=16777216,L});
